KISSY.add("datalazyload/impl",function(a,b,c,d){function r(c,e){var f=this;return f instanceof r?(e===d&&(e=c,c=[g]),a.isArray(c)||(c=[b.get(c)||g]),f.containers=c,f.config=a.merge(q,e),f.callbacks={els:[],fns:[]},f._init(),d):new r(c,e)}var e=window,f=.1,g=document,h="data-ks-lazyload",i="ks-datalazyload",j="-custom",k="manual",l="display",m="default",n="none",o="scroll",p="resize",q={mod:k,diff:m,placeholder:n,execScript:!0};return a.augment(r,{_init:function(){var a=this;a.threshold=a._getThreshold(),a._filterItems(),a._initLoadEvent()},_filterItems:function(){var c=this,d=c.containers,e,f,g,h,i,j,k=[],l=[];for(e=0,f=d.length;e<f;++e)g=b.query("img",d[e]),k=k.concat(a.filter(g,c._filterImg,c)),h=b.query("textarea",d[e]),l=l.concat(a.filter(h,c._filterArea,c));c.images=k,c.areaes=l},_filterImg:function(a){var c=this,d=a.getAttribute(h),e=c.threshold,f=c.config.placeholder,g=c.config.mod===k;if(g){if(d)return f!==n&&(a.src=f),!0}else if(b.offset(a).top>e&&!d)return b.attr(a,h,a.src),f!==n?a.src=f:a.removeAttribute("src"),!0},_filterArea:function(a){return b.hasClass(a,i)},_initLoadEvent:function(){function h(){if(b)return;b=a.later(function(){i(),b=null},f)}function i(){d._loadItems(),d._getItemsLength()===0&&(c.remove(e,o,h),c.remove(e,p,g))}var b,d=this,g;c.on(e,o,h),c.on(e,p,function(){d.threshold=d._getThreshold(),h()}),d._getItemsLength()&&a.ready(function(){i()})},_loadItems:function(){var a=this;a._loadImgs(),a._loadAreas(),a._fireCallbacks()},_loadImgs:function(){var b=this;b.images=a.filter(b.images,b._loadImg,b)},_loadImg:function(a){var c=this,d=b.scrollTop(),e=c.threshold+d,f=b.offset(a);if(!(f.top<=e))return!0;c._loadImgSrc(a)},_loadImgSrc:function(a,b){b=b||h;var c=a.getAttribute(b);c&&a.src!=c&&(a.src=c,a.removeAttribute(b))},_loadAreas:function(){var b=this;b.areaes=a.filter(b.areaes,b._loadArea,b)},_loadArea:function(a){var c=this,d,e=b.css(a,l)===n;d=b.offset(e?a.parentNode:a).top;if(!(d<=c.threshold+b.scrollTop()))return!0;c._loadAreaData(a.parentNode,a,c.config.execScript)},_loadAreaData:function(a,c,e){c.style.display=n,c.className="";var f=b.create("<div>");a.insertBefore(f,c),b.html(f,c.value,e===d?!0:e)},_fireCallbacks:function(){var a=this,c=a.callbacks,d=c.els,e=c.fns,f=b.scrollTop(),g=a.threshold+f,h,i,j,k=[],l=[];for(h=0;(i=d[h])&&(j=e[h++]);)b.offset(i).top<=g?j.call(i):(k.push(i),l.push(j));c.els=k,c.fns=l},addCallback:function(c,d){var e=this.callbacks;c=b.get(c),c&&a.isFunction(d)&&(e.els.push(c),e.fns.push(d)),this._fireCallbacks()},_getThreshold:function(){var a=this.config.diff,c=b.viewportHeight();return a===m?2*c:c+ +a},_getItemsLength:function(){var a=this;return a.images.length+a.areaes.length+a.callbacks.els.length},loadCustomLazyData:function(c,d){var e=this,f,g;d==="img-src"&&(d="img"),a.isArray(c)||(c=[b.get(c)]),a.each(c,function(c){switch(d){case"img":c.nodeName==="IMG"?g=[c]:g=b.query("img",c),a.each(g,function(a){e._loadImgSrc(a,h+j)});break;default:f=b.get("textarea",c),f&&b.hasClass(f,i+j)&&e._loadAreaData(c,f)}})}}),a.mix(r,r.prototype,!0,["loadCustomLazyData","_loadImgSrc","_loadAreaData"]),r},{requires:["dom","event"]}),KISSY.add("datalazyload",function(a,b){return a.DataLazyload=b,b},{requires:["datalazyload/impl"]});