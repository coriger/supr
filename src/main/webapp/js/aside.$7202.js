KISSY.add("lib/aside",function(a,b,c,d,e,f){function g(e){var f="#side-go-search",g=!1,k=a.get("#side-search-input"),l="#side-search-show-options",m="#side-search-options-list",n=b.get("li.item-myTrack",m),o=b.get("li.item-allBlog",m),p=b.get("li.item-allTag",m),q=b.get("li.item-myFav",m);if(!e)return;ENV.searchType?ENV.searchType=="follow"?(b.addClass(n,"on"),i(n)):ENV.searchType=="iposted"?(b.addClass(o,"on"),i(o)):ENV.searchType=="tag"?(b.addClass(p,"on"),i(p)):ENV.searchType=="fav"&&(b.addClass(q,"on"),i(q)):ENV.pageName&&ENV.pageName=="dianlog"?(b.addClass(o,"on"),i(o)):ENV.pageName&&ENV.pageName=="fav"?(b.addClass(q,"on"),i(q)):(b.addClass(p,"on"),i(p));try{d.inputTip(k)}catch(r){}c.on(e,"submit",function(c){var e,f,g,h,i="home";if(!(e=k))return;c.halt(),ENV.pageName=="dianlog"&&(i="dianlog"),f=a.JSON.parse(b.attr(e,"tip"));if(f&&f.text===(g=a.trim(e.value))||!g){e.focus();return}var j=b.get("#side-search-options-list li.on");b.hasClass(j,"item-allTag")?h=d.url.host+"/tagproxy?tag="+encodeURIComponent(g)+"&newbie=1":b.hasClass(j,"item-allBlog")?h=d.url.host+"/search?keyword="+encodeURIComponent(g):b.hasClass(j,"item-myTrack")?h=d.url.host+"/search/posttag/follow?from=home&k="+encodeURIComponent(g):b.hasClass(j,"item-myPost")?ENV.pageName&&ENV.pageName=="dianlog"?h=d.url.host+"/search/posttag/"+ENV.blogUrl+"/iposted?from="+i+"&k="+encodeURIComponent(g):h=d.url.host+"/search/posttag/iposted?from="+i+"&k="+encodeURIComponent(g):b.hasClass(j,"item-myFav")&&(h=d.url.host+"/search/posttag/fav?k="+encodeURIComponent(g)),location.href=h}),c.on(k,"focus",function(){b.addClass("#side-search-holder","focus");if(!!ENV.newbieTagGuide)return;b.css("#side-search-holder","zIndex","100")}),c.on(k,"blur",function(){b.removeClass("#side-search-holder","focus");if(!!ENV.newbieTagGuide)return;g=!0}),c.on(l,"click",function(a){a.halt();if(b.get("#side-search-options").style.display==""){b.hide("#side-search-options"),b.css("#side-search-holder","zIndex",""),b.removeClass("#side-search-show-options","active");return}b.show("#side-search-options"),b.css("#side-search-holder","zIndex","100"),b.addClass("#side-search-show-options","active")}),c.on(m,"mouseover",j),c.on(m,"mouseout",function(){b.removeClass("#side-search-options-list li","hover")}),c.on(m,"click",h),c.on(document.body,"click",function(c){b.hide("#side-search-options");var d=c.target,e=a.get("#side-search-linkfollowed");g&&d!=e&&d!=k&&(b.hide("#side-search-tip"),b.css("#side-search-holder","zIndex",""))})}function h(c){var e=c.target,f,g=b.get("#side-search-input"),h=g.value,j=a.JSON.parse(b.attr(g,"tip"));f=e.tagName.toLowerCase()==="li"?e:b.parent(e,"li"),b.removeClass("#side-search-options-list li","on"),b.addClass(f,"on"),i(f),g.value="";try{d.inputTip(g)}catch(k){}!h||h!=decodeURIComponent(j.text)&&(g.focus(),g.value=h)}function i(a){b.attr("#side-search-input","tip",'{"class":"input-tip", "text":"'+b.attr(a,"data-name")+'"}')}function j(a){var c=a.target,d;d=c.tagName.toLowerCase()==="li"?c:b.parent(c,"li"),b.removeClass("#side-search-options-list li","hover"),b.addClass(d,"hover")}function k(){function c(a){var c=parseInt(b.innerHTML);c+=a=="add"?1:-1,b.innerHTML=c}var b=a.get("#side-fav-count");if(!b)return;d.Dispatcher.on("post::like",function(){c("add")}),d.Dispatcher.on("post::unlike",function(){c("minus")})}function l(f){function n(a){var d=a.target,e=d.tagName,f=b.parent(d,"li"),g=document;if(!b.hasClass(d,"aside-icon"))return;a.halt();if(b.hasClass(f,"unfollowed-tag-page")||!b.hasClass(f,"aside-hot-tag"))return;startY=a.pageY,c.on(g,"mousemove",function(a){a.halt(),i=!0,o(a,f)}),c.on(g,"mouseup",function(a){a.halt(),c.remove(g,"mousemove"),c.remove(g,"mouseup");if(!i)return;p(f),i=!1,q()})}function o(a,c){var d=a.pageY,e=d-startY,g=b.attr(c,"tag");j=b.prev(c),k=b.next(c),b.attr(k,"tag")||(k=null),b.hasClass(j,"unfollowed-tag-page")&&(j=null),l=j?b.height(j):null,m=k?b.height(k):null,b.css(c,{opacity:.7,position:"relative",top:e,"z-index":100}),e>0&&m&&e>m&&(b.insertAfter(c,k),startY+=m,b.css(c,{top:0}),b.addClass(b.children(f)[0],"first"),b.removeClass(b.children(f)[1],"first")),e<0&&l&&-e>l&&(b.insertBefore(c,j),startY-=l,b.css(c,{top:0}),b.addClass(b.children(f)[0],"first"),b.removeClass(b.children(f)[1],"first"))}function p(a){b.css(a,{position:"relative",top:0,opacity:1,"z-index":0})}function q(){var c=b.children(f,".aside-hot-tag"),g=[];a.each(c,function(a){if(b.hasClass(a,"unfollowed-tag-page"))return;var c=decodeURIComponent(b.attr(a,"tag"));g.push(c)}),g=a.JSON.stringify(g),e.post(d.url.host+"/tagopt/saveWatchingTagSeq",{tags:g})}var g=b.children("li",f),h,i,j,k,l,m;c.on(f,"mousedown",n),c.on(f,"click",function(a){var c=a.target;b.hasClass(c,"aside-icon")&&a.halt()}),c.on("#aside-tag-toggler","click",function(){var a=b.query(".track-tag-hide",f);b.hasClass("#aside-tag-toggler","track-tag-showed")?(b.hide(a),b.removeClass("#aside-tag-toggler","track-tag-showed"),b.html("#aside-tag-toggler-text","\u5c55\u5f00\u5168\u90e8")):(b.show(a),b.addClass("#aside-tag-toggler","track-tag-showed"),b.html("#aside-tag-toggler-text","\u6536\u8d77")),d.Dispatcher.fire("asideTrackTagViewChange")})}function m(){var a=b.get("#aside-promotion");if(!a)return;c.on(a,"click",function(){d.log("aside-promotion-click")})}function n(f){function l(a){j[a]||(j[a]=!0,g.push(a))}function m(c,f){if(!!h)return;h=!0,e({type:"post",url:d.url.host+"/tagwatch/watch",data:{tagRole:c,status:0},success:function(e){if(e.status_code<0)d.alert(e.result);else{p(f),b.remove(f);var g="",h=b.get(".js-hook-track-tag","#aside"),i=b.create("<li>");if(!h)return;i.className="aside-hot-tag first",b.attr(i,"tag",encodeURIComponent(c)),g='<a class="followed-tag clearfix" href="'+d.url.host+"/tag/"+encodeURIComponent(c)+'">'+'<span class="aside-icon"></span>'+"<span>"+a.escapeHTML(c)+"</span>"+"</a>",i.innerHTML=g,b.prepend(i,h)}},complete:function(){h=!1}})}function n(a,c){if(!!i)return;i=!0,e({type:"post",data:{tag:a},url:d.url.host+"/ignore/editor_tag",success:function(a){!a.success||(p(c),b.remove(c))},complete:function(){i=!1}})}function o(){e({type:"get",url:d.url.host+"/editor_tag/more",success:function(b){a.each(b,function(a){l(a)})}})}function p(c){var e=g.pop(),f=b.create("<li>");!e||(f.className="aside-hot-tag",b.attr(f,"tag",encodeURIComponent(e)),html='<a target="_blank" href="'+d.url.host+"/tag/"+encodeURIComponent(e)+'">'+'<span class="aside-icon"></span>'+"<span>"+a.escapeHTML(e)+"\n"+'<span class="aside-rec-tag-notin" title="\u4e0d\u611f\u5174\u8da3">\u63a8\u8350\u8ba2\u9605</span>'+"</span>"+'<span class="sidemenu-item-follow" title="\u8ba2\u9605">\u8ba2\u9605</span>'+"</a>",f.innerHTML=html,b.insertAfter(f,c),r(f)),q()}function q(){var c=b.query(".aside-hot-tag",f),d=c.length;if(d==0){b.remove(f);return}a.each(c,function(a,c){b.removeClass(a,"first"),b.removeClass(a,"last"),c==0&&b.addClass(a,"first"),c==d-1&&b.addClass(a,"last")})}function r(a){var d=b.get(".aside-rec-tag-notin",a);c.on(a,"mouseenter",function(){d.innerHTML="X",b.addClass(d,"hover")}),c.on(a,"mouseleave",function(){d.innerHTML="\u63a8\u8350\u8ba2\u9605",b.removeClass(d,"hover")})}var g=[],h,i,j={},k;k=b.query(".aside-hot-tag",f),a.each(k,function(a){r(a);var c=b.attr(a,"tag");if(!c)return;c=decodeURIComponent(c),j[c]=!0}),c.on(f,"click",function(a){var c=a.target,d=b.parent(c,".aside-hot-tag"),e=b.attr(d,"tag");!e||(e=decodeURIComponent(e)),b.hasClass(c,"sidemenu-item-follow")&&(a.halt(),m(e,d)),b.hasClass(c,"aside-rec-tag-notin")&&(a.halt(),n(e,d))}),o()}function o(){var e=a.get("#side-search-form"),h=a.get(".js-hook-radar"),i=a.get(".js-hook-track-tag","#aside"),j=a.get("#rec-tag-list"),o=a.get("#J_Transfer");c.on(o,"click",function(a){f.set("transferUrl",b.attr(o,"data-blogUrl"),.1,"."+d.url.root,"/")}),e&&g(e),h&&KISSY.use("lib/radar.$7202",function(a,b){b.init(h)}),k(),!i||l(i),!j||n(j),m()}return{init:o}},{requires:["dom","event","util.$7202","ajax","cookie"]});