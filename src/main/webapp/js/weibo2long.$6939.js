KISSY.add("app/publisher/plugins/weibo2long",function(a,b,c,d,e){var f="#pb-weibo2long-holder",g="#pb-weibo2long",h="#pb-weibo2long-tip",i="#pb-weibo2long-preview",j,k="on",l={init:function(a){if(!b.get(f))return;this.context=a,this.postType=b.attr(f,"postType"),this.addEvent()},addEvent:function(){var a=this,d=this.context;c.on(f,"mouseover mouseleave",function(a){b.css(h,{visibility:a.type=="mouseover"?"visible":"hidden"})}),c.on(g,"click",function(){a._checkCkStatus()}),a._checkCkStatus(),c.on(i,"click",function(b){b.halt();var d=a.context.postToSelect;c.fire(ENV,"weibo2long::submit",{extraData:{weibo2longUrl:e.url.host+"/longweibo/preview",blogUrl:d?d.getValue():ENV.blogUrl,postType:a.postType}})}),c.on(ENV,"weibo2long::beforeStart",function(){a.dispatchLoading()}),c.on(ENV,"weibo2long::afterEnd",function(){a.dispatchLoadOk()}),c.on(ENV,"weibo2long::preview",function(b){a.dispatchLoadOk(),a.previewUrl(b.url)}),d.postToSelect&&(c.add(d.postToSelect,"change",function(){a._checkSyncStatus()}),a._checkSyncStatus())},_checkCkStatus:function(){var a=this,c=b.get(g).checked;b[c?"show":"hide"](i),c&&a.dispatchLoadOk()},_checkSyncStatus:function(){var a=this.context,c=a.postToSelect.getValue(),d="1"===a.dataSource[a.postToSelect.selectedIndex].isPrivace;!d&&(a.isSinaSync()||a.isQqSync())?(b.show(f),k="on"):(b.hide(f),k="off")},getData:function(){return k=="off"?{}:{longWeibo:b.get(g).checked?"true":"false"}},dispatchLoading:function(){b.html(i,"\u751f\u6210\u4e2d..."),b.addClass(i,"disable")},dispatchLoadOk:function(){b.html(i,"\u9884\u89c8"),b.removeClass(i,"disable")},previewUrl:function(d){function h(){b.css("#"+f+"_MASK",{height:b.docHeight(),opacity:.8}),b.css("#"+f+"_HOLDER",{height:b.viewportHeight()}),b.css("#"+f+"_HOLDER"+", #"+f+"_CLOSE",{top:b.scrollTop()})}var e=this,f="WEIBO2LONG";if(!this.mask){var g="<div id='{id}' style='display: none;' class='weibo2long'><a href='#' id='{id}_CLOSE' class='close' style='z-index:65536;'>x</a> <div style='position: absolute;top:0;left:0;z-index:65534;background:#000;width:100%;' id='{id}_MASK'></div><div style='position: absolute;top:0;left:0;z-index:65535;text-align:center;width:100%;overflow: auto;' id='{id}_HOLDER'><img src='' id='{id}_IMG' style='padding: 20px 0;'/></div></div>";g=a.substitute(g,{id:f}),b.get("body").appendChild(b.create(g)),this.mask=b.get("#"+f),c.on("#"+f+"_CLOSE, #"+f+"_HOLDER","click",function(){b.hide(e.mask),b.hide("#"+f+"_IMG"),b.css("html, body",{overflow:"auto"})})}c.on(window,"resize",h),b.css("html, body",{overflow:"hidden"});var i=new Image,j=b.get("#"+f+"_IMG");b.show(this.mask),i.onload=function(){var a=this.width,c=this.height,e,f,g=b.viewportWidth(),h=b.viewportHeight()-40;f=Math.min(g-60,a),e=f/a*c,b.css(j,{width:f,height:e,"margin-top":Math.max((h-e)/2,0)}),j.src=d},i.src=d,b.show(j),h()}};return l},{requires:["dom","event","ajax","util.$6939"]});