KISSY.add("app/home",function(a,b,c,d,e,f,g,h){function o(a){var b=ENV.markId?"?markId="+ENV.markId+"&lastReadTime="+ENV.lastReadTime+"&firstMarkTag="+ENV.firstMarkTag:"";m=new f("#feed-list",{lazyInit:!0,ImageLazyload:{enable:!0,limit:3},InfiniteLoad:{enable:!a.paging,api:e.url.host+"/newsfeed/{{feedId}}"+b},ImageSupport:{enable:!0},AudioSupport:{enable:!0},VideoSupport:{enable:!0},ScrollTopButton:{enable:!0,positionBottom:30},KeyboardShortcut:{enable:!0},HoverLink:{enable:!0},Comment:{enable:!0},Notes:{enable:!0},FeedAction:{enable:!0}}),q(),r(),s(a),e.Dispatcher.on("msg-box-mark-all-as-read",function(){m.updateFeedOffsetInfo()}),c.delegate(document,"click","a.hock-readmark-link",p)}function p(a){var c=a.currentTarget;if(b.hasClass(c,"hock-wall-link"))h.Tracker("readmark_wall_link",[{name:"ref",value:"home"}]);else if(b.hasClass(c,"hock-tag-link")){var d=b.attr(c,"data-tag");h.Tracker("readmark_tag_link",[{name:"ref",value:"home"},{name:"tag",value:d}])}}function q(){b.get("#activity-connect")&&g.get("index-bmt-Transfer")&&!g.get("index-bmt-Connect")&&(b.show("#activity-connect"),c.on("#activity-connect-close","click",function(){b.hide("#activity-connect"),g.set("index-bmt-Connect",1,new Date(2999,1,1),"","/")}))}function r(){function f(){b.viewportWidth()<1e3?(b.hide(d),e=!1):e||(b.show(d),e=!0)}var d=a.get("#J_WebGuideButton"),e=!0;if(!d)return;f(),c.on(window,"resize",f)}function s(b){if(b.paging&&!b.isFirstPage)return;var d=a.get("#new-feed-count");if(!d)return;t(d),n=setTimeout(function(){v(d)},k),c.on(d,"click",function(){location.reload()})}function t(a){b.hide(a),i.title=i.title.replace(l,"")}function u(){n&&(clearTimeout(n),n=null)}function v(a){var c,e;(c=m.feeds[0])&&(e=c.id)&&d.get(j,{uuid:e,rnd:+(new Date)},function(c){var d,e;"0"===c?(t(a),n=setTimeout(function(){v(a)},k)):c&&/^\d+$/.test(c)?(d=parseInt(c,10),d>10?(e="10+",b.addClass(a,"large-pop-notice"),clearTimeout(n),n=null):(e=d,b.removeClass(a,"large-pop-notice"),n=setTimeout(function(){v(a)},k)),a.innerHTML=e,b.show(a),i.title="("+e+")"+i.title.replace(l,"")):(u(),t(a))},"text")}var i=document,j=e.url.host+"/feedcount",k=1e5,l=/^\(\d+\+*\)/,m,n;return{init:o}},{requires:["dom","event","ajax","util.$7202","lib/feed.$7227","cookie","lib/tracker.$6736"]});