KISSY.add("lib/radar",function(a,b,c,d,e,f){var g=b.get,h=c.on,i;return i={init:function(a){a=a||g(".js-hook-radar");if(!a)return;var c=g(".radarpro-item",a),f="";!c||(f="?firstId="+b.attr(c,"data-id")),d({url:e.url.host+"/sidebar/radar"+f,type:"get",dataType:"html",success:function(c){var d=g(".js-hook-items-wrap",a);b.appendHtml(d,c),i.__init(a)}})},__init:function(a){function m(c){a._lockTime=!1,b.css(d,"visibility","visible"),b.css(e,"visibility","visible"),b.css(j,"visibility","visible"),b.css(k,"visibility","visible")}function n(c){a._lockTime=!0,setTimeout(function(c){a._lockTime===!0&&(b.css(d,"visibility","hidden"),b.css(e,"visibility","hidden"),b.css(j,"visibility","hidden"),b.css(k,"visibility","hidden"))},1e3)}var c=g(".radarpro-items-wrap",a),d=g(".radarpro-next",a),e=g(".radarpro-prev",a),j=b.query(".reblog",a),k=b.query(".fav",a),l=new f.Carousel(a,{pauseOnHover:!0,circular:!0,prevBtnCls:"radarpro-prev",nextBtnCls:"radarpro-next",lazyDataType:"img-src",hasTriggers:!1});i.switchable=l,h(a,"click",i.radarClickHandler),h(a,"mouseover",m),h(a,"mouseout",n),h(d,"mouseover",function(){b.addClass(d,"radarpro-next-hover")}),h(d,"mouseout",function(){b.removeClass(d,"radarpro-next-hover")}),h(e,"mouseover",function(){b.addClass(e,"radarpro-prev-hover")}),h(e,"mouseout",function(){b.removeClass(e,"radarpro-prev-hover")}),h(".radarpro-ctrl-btn","mouseover",function(a){var c=a.target;b.addClass(c,"radarpro-ctrl-btn-hover")}),h(".radarpro-ctrl-btn","mouseout",function(a){var c=a.target;b.removeClass(c,"radarpro-ctrl-btn-hover")}),h(".radarpro-item-info","mouseover",function(a){var c=this,d=b.get(".radarpro-item-fromradar",c),e=b.get(".follow",c);e&&!e._followed&&(b.hide(d),b.show(e))}),h(".radarpro-item-info","mouseout",function(a){var c=this,d=b.get(".radarpro-item-fromradar",c),e=b.get(".follow",c);b.hide(e),b.show(d)}),i.__initShadowCover()},radarClickHandler:function(a){var c=a.target,d,f=b.attr(c,"dd-cmd");if(f==="fav")i.actionFav(c),e.log("aside-radar-fav");else if(f==="reblog")e.log("aside-radar-reblog"),i.actionReblog(c);else if(f==="follow")i.actionFollow(c),e.log("aside-radar-follow");else{d=b.parent(c,".radarpro-item");if(!d)return;!b.attr(c,"href")&&!b.hasClass(b.parent(c),"radarpro-item-avatar")&&window.open(b.attr(d,"data-link")),e.log("aside-radar-link-click")}},actionReblog:function(a){var c=b.parent(a,".radarpro-item"),d=b.attr(c,"data-id");location.href=e.url.host+"/repost/new/"+d},actionFav:function(a){var c=b.hasClass(a,"faved"),f=b.parent(a,".radarpro-item"),g=b.attr(f,"data-id"),h=c?e.url.host+"/fav/remove":e.url.host+"/fav";d.post(h,{feed_id:g},function(d){d.errCode==0?c?b.removeClass(a,"faved"):b.addClass(a,"faved"):e.alert(d.result)})},actionFollow:function(c){var d=a.JSON.parse(b.attr(c,"data-follow").replace(/'/g,'"'));e.follow.follow(d.id,function(){b.hide(c),c._followed=!0,e.globalNotify(a.format("\u6210\u529f\u5173\u6ce8\u4e86{0}",decodeURIComponent(d.name)))})},__initShadowCover:function(){function f(a){var c,f=b.get(".radarpro-item-bottom",a),g=b.get(".radarpro-content-holder",a),c=b.get("img",g),h=b.height(g);b.hasClass(a,"radarpro-type-text")&&(h+=e),b.css(f,{height:h-d}),!!c&&!c.__inited&&(c.__inited=!0,c.onload=function(){var a=b.height(g);b.css(f,{height:a-d}),c.onload=null})}var c=b.query(".radarpro-item",".js-hook-items-wrap"),d=50,e=33;a.each(c,function(a){f(a)}),i.switchable.on("switch",function(a){var b=a.currentIndex;f(c[b])})}},i},{requires:["dom","event","ajax","util.$7202","switchable","datalazyload"]});